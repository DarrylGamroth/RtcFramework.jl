        - """
        - Test suite for counter system.
        - Tests counter allocation, operations, and agent identification.
        - """
        1 function test_counters(client)
        1     @testset "Counters struct fields" begin
        3         agent_id = 42
        1         agent_name = "TestAgent"
        - 
        1         counters = Counters(client, agent_id, agent_name)
        - 
        -         # Test all counter fields are allocated
        2         @test !isnothing(counters.total_duty_cycles)
        2         @test !isnothing(counters.total_work_done)
        2         @test !isnothing(counters.properties_published)
        2         @test !isnothing(counters.events_dispatched)
        - 
        -         # Test counters are Aeron.Counter instances
        1         @test counters.total_duty_cycles isa Aeron.Counter
        1         @test counters.total_work_done isa Aeron.Counter
        1         @test counters.properties_published isa Aeron.Counter
        1         @test counters.events_dispatched isa Aeron.Counter
        - 
        -         # Test initial values are zero
        1         @test counters.total_duty_cycles[] == 0
        1         @test counters.total_work_done[] == 0
        1         @test counters.properties_published[] == 0
        1         @test counters.events_dispatched[] == 0
        -     end
        - 
        -     @testset "Counter operations" begin
        3         counters = Counters(client, 1, "TestOps")
        - 
        -         # Test increment by 1 (default)
        1         Aeron.increment!(counters.total_duty_cycles)
        1         @test counters.total_duty_cycles[] == 1
        - 
        1         Aeron.increment!(counters.total_duty_cycles)
        1         @test counters.total_duty_cycles[] == 2
        - 
        -         # Test increment by delta
        1         Aeron.increment!(counters.total_work_done, 10)
        1         @test counters.total_work_done[] == 10
        - 
        1         Aeron.increment!(counters.total_work_done, 5)
        1         @test counters.total_work_done[] == 15
        - 
        -         # Test set operation
        1         counters.properties_published[] = 100
        1         @test counters.properties_published[] == 100
        - 
        -         # Test counters are independent
        1         @test counters.total_duty_cycles[] == 2
        1         @test counters.total_work_done[] == 15
        1         @test counters.properties_published[] == 100
        - 
        -         # Test events_dispatched counter
        1         Aeron.increment!(counters.events_dispatched)
        1         @test counters.events_dispatched[] == 1
        -     end
        - 
        -     @testset "add_counter helper function" begin
        3         agent_id = 123
        1         agent_name = "HelperTest"
        - 
        -         # Test add_counter creates a valid counter
        1         custom_counter = RtcFramework.add_counter(client, agent_id, agent_name, 2001, "CustomCounter")
        1         @test custom_counter isa Aeron.Counter
        1         @test custom_counter[] == 0
        - 
        -         # Test counter is usable
        1         Aeron.increment!(custom_counter, 42)
        1         @test custom_counter[] == 42
        - 
        1         close(custom_counter)
        -     end
        - 
        -     @testset "Multiple agents sharing MediaDriver" begin
        -         # Simulate multiple agents
        3         agent1 = Counters(client, 1, "Agent1")
        1         agent2 = Counters(client, 2, "Agent2")
        1         agent3 = Counters(client, 3, "Agent3")
        - 
        -         # Each agent's counters are independent
        1         Aeron.increment!(agent1.total_duty_cycles, 10)
        1         Aeron.increment!(agent2.total_duty_cycles, 20)
        1         Aeron.increment!(agent3.total_duty_cycles, 30)
        - 
        1         @test agent1.total_duty_cycles[] == 10
        1         @test agent2.total_duty_cycles[] == 20
        1         @test agent3.total_duty_cycles[] == 30
        -     end
        - 
        -     @testset "Counter close" begin
        2         counters = Counters(client, 100, "TestClose")
        - 
        -         # Verify counters are open
        2         @test Aeron.isopen(counters.total_duty_cycles)
        2         @test Aeron.isopen(counters.total_work_done)
        2         @test Aeron.isopen(counters.properties_published)
        2         @test Aeron.isopen(counters.events_dispatched)
        - 
        -         # Close all counters
        1         close(counters)
        - 
        -         # Verify all counters are closed
        2         @test !Aeron.isopen(counters.total_duty_cycles)
        2         @test !Aeron.isopen(counters.total_work_done)
        2         @test !Aeron.isopen(counters.properties_published)
        2         @test !Aeron.isopen(counters.events_dispatched)
        -     end
        - end
